<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Tracker</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCH6T0_ockPSdbXjAGi7igtXP5GkRTnM6A&callback=initMap" async defer></script>
    <script>
        let map;
        let marker;

        // Function to initialize the Google Map
        function initMap() {
            // Initialize map centered at a default location (e.g., San Francisco)
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 72.4067, lng: 78.477 },
                zoom: 12
            });
            // Create a marker
            marker = new google.maps.Marker({
                map: map,
                position: { lat: 72.4067, lng: 78.477 },
                title: "Current Location"
            });
        }

        // Function to handle streaming location data from the server
        const eventSource = new EventSource("/location");

        eventSource.onmessage = function(event) {
            try {
                // Parse the received data
                const location = JSON.parse(event.data);
                const lat = location.lat;
                const lng = location.lng;

                // Ensure the received latitude and longitude are valid before updating the map
                if (lat !== 0 && lng !== 0) {
                    // Update the marker position with the new location
                    marker.setPosition(new google.maps.LatLng(lat, lng));
                    map.setCenter(new google.maps.LatLng(lat, lng));  // Optionally, center the map to the new location
                } else {
                    console.log("Invalid location data received: Latitude and Longitude are 0.");
                }
            } catch (error) {
                console.error("Error parsing location data:", error);
            }
        };

        // Error handling for EventSource connection
        eventSource.onerror = function(event) {
            console.error("Error with the EventSource connection:", event);
        };
    </script>
</head>
<body onload="initMap()">
    <h1>Location Tracker</h1>
    <div id="map" style="height: 500px; width: 100%;"></div>
</body>
</html>
